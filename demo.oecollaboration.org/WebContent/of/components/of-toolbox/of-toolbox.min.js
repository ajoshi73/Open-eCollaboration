+ function($) {

    'use strict';

    $(document).ready(function() {

        var x = 0;

        $('.of-toolbox').each(function() {
            $(this).attr('data-id', x++).ofToolbox();
        });

    });

    $.fn.ofToolbox = function() {

        var el = $(this),
            elId = $(this).data('id');

        // 

        el.find('ul a').on('click', function(e) {

            if (typeof $(this).data('of-open-modal') === 'undefined') {
                if (typeof $(this).data('of-copy') !== 'undefined') {
                    e.stopPropagation();
                    prompt('Kopiera länken nedan', $(this).attr('href'));
                    return false;

                }
                e.stopPropagation();

                return;
            }

            return;

        });

        el.on('click', function(e) {
        	
            if (typeof $(e.toElement).data('of-open-modal') === 'undefined' && typeof $(e.toElement).parents('a').first().data('of-open-modal') === 'undefined') {
                e.preventDefault();
                //e.stopPropagation();
            }

            $('.of-toolbox:not([data-id=' + elId + '])').removeClass('of-active');

            if (el.hasClass('of-active')) {
                el.removeClass('of-active');
                return;
            }

            el.addClass('of-active');

        });

        $(document).on('click', function(e) {
        	if(typeof $(e.target).parent().parent().parent().data("id") === "undefined") {
        		el.removeClass('of-active');
        	}
        }).on('keyup', function(e) {
            var key = e.keyCode ? e.keyCode : e.which;

            if (key === 27) {
                el.removeClass('of-active');
            }
        });

    }

}(jQuery);